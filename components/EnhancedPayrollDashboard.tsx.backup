'use client'

import React, { useState, useEffect } from 'react';
import { 
  Users, 
  DollarSign, 
  Clock, 
  TrendingUp, 
  Search, 
  Filter, 
  Plus,
  Eye,
  Edit,
  Check,
  X,
  Calendar,
  Building,
  User,
  LogOut,
  Menu,
  Home,
  FileText,
  Settings,
  UserPlus,
  UserMinus
} from 'lucide-react';
import { supabase, Employee, PayrollStatement, OvertimeRecord } from '@/lib/supabase';

const PayrollDashboard = () => {
  const [currentView, setCurrentView] = useState('dashboard');
  const [sidebarOpen, setSidebarOpen] = useState(true);
  const [selectedMonth, setSelectedMonth] = useState('JULY');
  const [selectedYear, setSelectedYear] = useState(2025);
  const [searchTerm, setSearchTerm] = useState('');
  const [loading, setLoading] = useState(true);

  // ìƒíƒœ ê´€ë¦¬
  const [employees, setEmployees] = useState<Employee[]>([]);
  const [payrollData, setPayrollData] = useState<PayrollStatement[]>([]);
  const [overtimeData, setOvertimeData] = useState<OvertimeRecord[]>([]);
  const [companySettings, setCompanySettings] = useState<any>(null);

  // ëª¨ë‹¬ ìƒíƒœ ê´€ë¦¬
  const [showPayrollModal, setShowPayrollModal] = useState(false);
  const [showOvertimeModal, setShowOvertimeModal] = useState(false);
  const [showEmployeeModal, setShowEmployeeModal] = useState(false);
  const [editingPayroll, setEditingPayroll] = useState<PayrollStatement | null>(null);
  const [editingOvertime, setEditingOvertime] = useState<OvertimeRecord | null>(null);
  const [editingEmployee, setEditingEmployee] = useState<Employee | null>(null);

  // ìƒˆ ë°ì´í„° ìƒíƒœ
  const [newPayroll, setNewPayroll] = useState({
    employee_id: 0,
    base_salary: 0,
    performance_bonus: 0,
    special_bonus: 0,
    position_allowance: 0,
    meal_allowance: 0,
    transport_allowance: 0,
    social_insurance: 0,
    personal_tax: 0,
    advance_salary: 0,
    salary_deduction: 0,
    other_deductions: 0
  });

  const [newOvertime, setNewOvertime] = useState({
    employee_id: 0,
    overtime_date: '',
    start_time: '',
    end_time: '',
    work_description: '',
    reason: 'OTHER',
    priority: 'MEDIUM'
  });

  const [newEmployee, setNewEmployee] = useState({
    employee_code: '',
    nick_name: '',
    full_name: '',
    full_name_thai: '',
    department: 'IT',
    start_date: '',
    bank_name: '',
    bank_account: '',
    monthly_salary: '',
    social_insurance_rate: '5',
    tax_rate: '10',
    performance_rating: 3,
    status: 'ACTIVE'
  });

  // ë°ì´í„° ë¡œë“œ
  useEffect(() => {
    loadData();
  }, [selectedYear, selectedMonth]);

  const loadData = async () => {
    setLoading(true);
    try {
      // Supabase ì—°ê²° í™•ì¸
      if (!supabase) {
        throw new Error('Supabase í´ë¼ì´ì–¸íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
      }

      // ì§ì› ë°ì´í„° ë¡œë“œ
      const { data: employeesData, error: employeesError } = await supabase
        .from('employees')
        .select('*')
        .eq('status', 'ACTIVE');

      if (employeesError) {
        console.error('ì§ì› ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', employeesError);
        throw new Error(`ì§ì› ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${employeesError.message}`);
      }
      setEmployees(employeesData || []);

      // ê¸‰ì—¬ ë°ì´í„° ë¡œë“œ
      const { data: payrollData, error: payrollError } = await supabase
        .from('payroll_statements')
        .select(`
          *,
          employees (
            employee_code,
            nick_name,
            full_name,
            department
          )
        `)
        .eq('pay_year', selectedYear)
        .eq('pay_month', selectedMonth);

      if (payrollError) {
        console.error('ê¸‰ì—¬ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', payrollError);
        throw new Error(`ê¸‰ì—¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${payrollError.message}`);
      }
      setPayrollData(payrollData || []);

      // ì˜¤ë²„íƒ€ì„ ë°ì´í„° ë¡œë“œ
      const { data: overtimeData, error: overtimeError } = await supabase
        .from('overtime_records')
        .select(`
          *,
          employees (
            employee_code,
            nick_name
          )
        `)
        .eq('overtime_date', `${selectedYear}-${getMonthNumber(selectedMonth)}-01`);

      if (overtimeError) {
        console.error('ì˜¤ë²„íƒ€ì„ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', overtimeError);
        throw new Error(`ì˜¤ë²„íƒ€ì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${overtimeError.message}`);
      }
      setOvertimeData(overtimeData || []);

      // íšŒì‚¬ ì„¤ì • ë¡œë“œ
      const { data: settingsData, error: settingsError } = await supabase
        .from('company_settings')
        .select('*')
        .eq('id', 1)
        .single();

      if (settingsError) {
        console.error('íšŒì‚¬ ì„¤ì • ë¡œë“œ ì˜¤ë¥˜:', settingsError);
        // ì˜¤ë¥˜ê°€ ìˆì–´ë„ ê¸°ë³¸ê°’ ì‚¬ìš©
        setCompanySettings({
          company_name: 'ê¸‰ì—¬ê´€ë¦¬ ì‹œìŠ¤í…œ',
          logo_url: null,
          logo_filename: null
        });
      } else {
        setCompanySettings(settingsData);
      }

    } catch (error) {
      console.error('ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
      // ì‚¬ìš©ìì—ê²Œ ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ (ì¶”í›„ ì•Œë¦¼ ì»´í¬ë„ŒíŠ¸ ì¶”ê°€ ì˜ˆì •)
      alert(`ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
    } finally {
      setLoading(false);
    }
  };

  const getMonthNumber = (month: string) => {
    const months: { [key: string]: string } = {
      'JANUARY': '01', 'FEBRUARY': '02', 'MARCH': '03', 'APRIL': '04',
      'MAY': '05', 'JUNE': '06', 'JULY': '07', 'AUGUST': '08',
      'SEPTEMBER': '09', 'OCTOBER': '10', 'NOVEMBER': '11', 'DECEMBER': '12'
    };
    return months[month] || '01';
  };

  // í†µê³„ ê³„ì‚°
  const totalEmployees = employees.length;
  const totalGrossSalary = payrollData.reduce((sum, emp) => {
    const gross = emp.base_salary + 
                  (emp.total_overtime_hours * emp.overtime_rate) + 
                  emp.performance_bonus + 
                  emp.special_bonus + 
                  emp.position_allowance + 
                  emp.meal_allowance + 
                  emp.transport_allowance;
    return sum + gross;
  }, 0);
  const totalOvertimeHours = payrollData.reduce((sum, emp) => sum + emp.total_overtime_hours, 0);
  const pendingApprovals = payrollData.filter(emp => emp.status === 'DRAFT').length;

  // í•„í„°ë§ëœ ë°ì´í„°
  const filteredPayrollData = payrollData.filter(emp => {
    const employee = emp.employees as any;
    return employee?.nick_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
           employee?.full_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
           employee?.employee_code?.toLowerCase().includes(searchTerm.toLowerCase());
  });

  // ê¸‰ì—¬ëª…ì„¸ì„œê°€ ì—†ëŠ” ì§ì›ë“¤ ì°¾ê¸°
  const employeesWithoutPayroll = employees.filter(emp => 
    !payrollData.some(p => p.employee_id === emp.id)
  );

  // ì˜¤ë²„íƒ€ì„ ìŠ¹ì¸/ê±°ë¶€ í•¨ìˆ˜
  const handleOvertimeAction = async (overtimeId: number, action: 'APPROVE' | 'REJECT', reason?: string) => {
    try {
      const { error } = await supabase.rpc('approve_overtime_record', {
        p_overtime_id: overtimeId,
        p_admin_id: 1, // ì‹¤ì œë¡œëŠ” ë¡œê·¸ì¸ëœ ê´€ë¦¬ì ID
        p_status: action,
        p_rejection_reason: reason
      });

      if (error) throw error;
      loadData(); // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
    } catch (error) {
      console.error('ì˜¤ë²„íƒ€ì„ ì²˜ë¦¬ ì˜¤ë¥˜:', error);
    }
  };

  // ê¸‰ì—¬ê´€ë¦¬ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë“¤
  const handleAddPayroll = async () => {
    try {
      if (!newPayroll.employee_id || !newPayroll.base_salary || Number(newPayroll.base_salary) <= 0) {
        alert('ì§ì›ì„ ì„ íƒí•˜ê³  ê¸°ë³¸ê¸‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      const { data, error } = await supabase
        .from('payroll_statements')
        .insert([
          {
            employee_id: newPayroll.employee_id,
            pay_year: selectedYear,
            pay_month: selectedMonth,
            pay_period_start: `${selectedYear}-${getMonthNumber(selectedMonth)}-01`,
            pay_period_end: `${selectedYear}-${getMonthNumber(selectedMonth)}-31`,
            payment_date: new Date().toISOString().split('T')[0],
            work_days: 22,
            actual_work_days: 22,
            base_salary: Number(newPayroll.base_salary) || 0,
            hourly_rate: 0,
            overtime_rate: 0,
            performance_bonus: Number(newPayroll.performance_bonus) || 0,
            special_bonus: Number(newPayroll.special_bonus) || 0,
            position_allowance: Number(newPayroll.position_allowance) || 0,
            meal_allowance: Number(newPayroll.meal_allowance) || 0,
            transport_allowance: Number(newPayroll.transport_allowance) || 0,
            total_overtime_hours: 0,
            social_insurance: Number(newPayroll.social_insurance) || 0,
            personal_tax: Number(newPayroll.personal_tax) || 0,
            advance_salary: Number(newPayroll.advance_salary) || 0,
            salary_deduction: Number(newPayroll.salary_deduction) || 0,
            other_deductions: Number(newPayroll.other_deductions) || 0,
            status: 'DRAFT',
            created_by: 1
          }
        ]);

      if (error) throw error;
      alert('ê¸‰ì—¬ëª…ì„¸ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
      setShowPayrollModal(false);
      setNewPayroll({
        employee_id: 0,
        base_salary: 0,
        performance_bonus: 0,
        special_bonus: 0,
        position_allowance: 0,
        meal_allowance: 0,
        transport_allowance: 0,
        social_insurance: 0,
        personal_tax: 0,
        advance_salary: 0,
        salary_deduction: 0,
        other_deductions: 0
      });
      loadData();
    } catch (error) {
      console.error('ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ì˜¤ë¥˜:', error);
      alert(`ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
    }
  };

  const handleUpdatePayroll = async () => {
    try {
      if (!editingPayroll) return;

      const { data, error } = await supabase
        .from('payroll_statements')
        .update({
          base_salary: editingPayroll.base_salary,
          performance_bonus: editingPayroll.performance_bonus,
          special_bonus: editingPayroll.special_bonus,
          position_allowance: editingPayroll.position_allowance,
          meal_allowance: editingPayroll.meal_allowance,
          transport_allowance: editingPayroll.transport_allowance,
          social_insurance: editingPayroll.social_insurance,
          personal_tax: editingPayroll.personal_tax,
          advance_salary: editingPayroll.advance_salary,
          salary_deduction: editingPayroll.salary_deduction,
          other_deductions: editingPayroll.other_deductions,
          status: editingPayroll.status
        })
        .eq('id', editingPayroll.id);

      if (error) throw error;
      alert('ê¸‰ì—¬ëª…ì„¸ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
      setShowPayrollModal(false);
      setEditingPayroll(null);
      loadData();
    } catch (error) {
      console.error('ê¸‰ì—¬ëª…ì„¸ì„œ ìˆ˜ì • ì˜¤ë¥˜:', error);
      alert('ê¸‰ì—¬ëª…ì„¸ì„œ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const handlePayrollStatusChange = async (payrollId: number, status: string) => {
    try {
      const { data, error } = await supabase
        .from('payroll_statements')
        .update({ status })
        .eq('id', payrollId);

      if (error) throw error;
      alert(`ê¸‰ì—¬ëª…ì„¸ì„œ ìƒíƒœê°€ ${status === 'APPROVED' ? 'ìŠ¹ì¸' : 'ë°˜ë ¤'}ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      loadData();
    } catch (error) {
      console.error('ê¸‰ì—¬ëª…ì„¸ì„œ ìƒíƒœ ë³€ê²½ ì˜¤ë¥˜:', error);
      alert('ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  // ì§ì›ê´€ë¦¬ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë“¤
  const handleAddEmployee = async () => {
    try {
      // í•„ìˆ˜ í•„ë“œ ê²€ì¦
      if (!newEmployee.employee_code.trim()) {
        alert('ì§ì›ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      if (!newEmployee.nick_name.trim()) {
        alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      if (!newEmployee.full_name.trim()) {
        alert('ì „ì²´ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      // ì§ì›ì½”ë“œ ì¤‘ë³µ ê²€ì‚¬
      const { data: existingEmployee, error: checkError } = await supabase
        .from('employees')
        .select('id')
        .eq('employee_code', newEmployee.employee_code.trim())
        .single();

      if (existingEmployee) {
        alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì§ì›ì½”ë“œì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì§ì›ì½”ë“œë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
        return;
      }

      // ê¸°ë³¸ê°’ ì„¤ì •
      const employeeData = {
        ...newEmployee,
        employee_code: newEmployee.employee_code.trim(),
        nick_name: newEmployee.nick_name.trim(),
        full_name: newEmployee.full_name.trim(),
        full_name_thai: newEmployee.full_name_thai.trim(),
        bank_name: newEmployee.bank_name.trim(),
        bank_account: newEmployee.bank_account.trim(),
        monthly_salary: newEmployee.monthly_salary || 0,
        social_insurance_rate: newEmployee.social_insurance_rate || 5,
        tax_rate: newEmployee.tax_rate || 10,
        performance_rating: newEmployee.performance_rating || 3,
        status: newEmployee.status || 'ACTIVE',
        start_date: newEmployee.start_date || new Date().toISOString().split('T')[0]
      };

      const { data, error } = await supabase
        .from('employees')
        .insert([employeeData]);

      if (error) {
        console.error('Supabase ì˜¤ë¥˜:', error);
        if (error.code === '23505') {
          alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì§ì›ì½”ë“œì…ë‹ˆë‹¤.');
        } else {
          alert(`ì§ì› ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
        }
        return;
      }

      alert('ì§ì›ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
      setShowEmployeeModal(false);
      
      // í¼ ì´ˆê¸°í™”
      setNewEmployee({
        employee_code: '',
        nick_name: '',
        full_name: '',
        full_name_thai: '',
        department: 'IT',
        start_date: '',
        bank_name: '',
        bank_account: '',
        monthly_salary: 0,
        social_insurance_rate: 5,
        tax_rate: 10,
        performance_rating: 3,
        status: 'ACTIVE'
      });
      
      loadData();
    } catch (error) {
      console.error('ì§ì› ì¶”ê°€ ì˜¤ë¥˜:', error);
      alert('ì§ì› ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    }
  };

  const handleUpdateEmployee = async () => {
    try {
      if (!editingEmployee) return;

      const { data, error } = await supabase
        .from('employees')
        .update(editingEmployee)
        .eq('id', editingEmployee.id);

      if (error) throw error;
      alert('ì§ì› ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
      setShowEmployeeModal(false);
      setEditingEmployee(null);
      loadData();
    } catch (error) {
      console.error('ì§ì› ìˆ˜ì • ì˜¤ë¥˜:', error);
      alert('ì§ì› ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const handleEmployeeStatusChange = async (employeeId: number, status: string) => {
    try {
      const { data, error } = await supabase
        .from('employees')
        .update({ status })
        .eq('id', employeeId);

      if (error) throw error;
      alert(`ì§ì› ìƒíƒœê°€ ${status === 'ACTIVE' ? 'í™œì„±' : status === 'INACTIVE' ? 'ë¹„í™œì„±' : 'í‡´ì‚¬'}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
      loadData();
    } catch (error) {
      console.error('ì§ì› ìƒíƒœ ë³€ê²½ ì˜¤ë¥˜:', error);
      alert('ìƒíƒœ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  // ì˜¤ë²„íƒ€ì„ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë“¤
  const handleAddOvertime = async () => {
    try {
      if (!newOvertime.employee_id || !newOvertime.overtime_date || !newOvertime.start_time || !newOvertime.end_time) {
        alert('í•„ìˆ˜ í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      // í•´ë‹¹ ì›”ì˜ ê¸‰ì—¬ëª…ì„¸ì„œ ID ì°¾ê¸°
      const overtimeDate = new Date(newOvertime.overtime_date);
      const year = overtimeDate.getFullYear();
      const month = overtimeDate.getMonth() + 1;
      const monthNames = [
        'JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE',
        'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER'
      ];
      const monthName = monthNames[month - 1];

      const { data: payrollData, error: payrollError } = await supabase
        .from('payroll_statements')
        .select('id')
        .eq('employee_id', newOvertime.employee_id)
        .eq('pay_year', year)
        .eq('pay_month', monthName)
        .single();

      if (payrollError || !payrollData) {
        alert('í•´ë‹¹ ì›”ì˜ ê¸‰ì—¬ëª…ì„¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê¸‰ì—¬ëª…ì„¸ì„œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.');
        return;
      }

      const { data, error } = await supabase
        .from('overtime_records')
        .insert([
          {
            payroll_id: payrollData.id,
            employee_id: newOvertime.employee_id,
            overtime_date: newOvertime.overtime_date,
            start_time: newOvertime.start_time,
            end_time: newOvertime.end_time,
            work_description: newOvertime.work_description,
            reason: newOvertime.reason,
            priority: newOvertime.priority,
            status: 'PENDING',
            created_by: 1
          }
        ]);

      if (error) throw error;
      alert('ì˜¤ë²„íƒ€ì„ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
      setShowOvertimeModal(false);
      setNewOvertime({
        employee_id: 0,
        overtime_date: '',
        start_time: '',
        end_time: '',
        work_description: '',
        reason: 'OTHER',
        priority: 'MEDIUM'
      });
      loadData();
    } catch (error) {
      console.error('ì˜¤ë²„íƒ€ì„ ì¶”ê°€ ì˜¤ë¥˜:', error);
      alert('ì˜¤ë²„íƒ€ì„ ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const handleUpdateOvertime = async () => {
    try {
      if (!editingOvertime) return;

      // í•´ë‹¹ ì›”ì˜ ê¸‰ì—¬ëª…ì„¸ì„œ ID ì°¾ê¸° (ë‚ ì§œê°€ ë³€ê²½ëœ ê²½ìš°)
      const overtimeDate = new Date(editingOvertime.overtime_date);
      const year = overtimeDate.getFullYear();
      const month = overtimeDate.getMonth() + 1;
      const monthNames = [
        'JANUARY', 'FEBRUARY', 'MARCH', 'APRIL', 'MAY', 'JUNE',
        'JULY', 'AUGUST', 'SEPTEMBER', 'OCTOBER', 'NOVEMBER', 'DECEMBER'
      ];
      const monthName = monthNames[month - 1];

      const { data: payrollData, error: payrollError } = await supabase
        .from('payroll_statements')
        .select('id')
        .eq('employee_id', editingOvertime.employee_id)
        .eq('pay_year', year)
        .eq('pay_month', monthName)
        .single();

      if (payrollError || !payrollData) {
        alert('í•´ë‹¹ ì›”ì˜ ê¸‰ì—¬ëª…ì„¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê¸‰ì—¬ëª…ì„¸ì„œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.');
        return;
      }

      const { data, error } = await supabase
        .from('overtime_records')
        .update({
          payroll_id: payrollData.id,
          overtime_date: editingOvertime.overtime_date,
          start_time: editingOvertime.start_time,
          end_time: editingOvertime.end_time,
          work_description: editingOvertime.work_description,
          reason: editingOvertime.reason,
          priority: editingOvertime.priority
        })
        .eq('id', editingOvertime.id);

      if (error) throw error;
      alert('ì˜¤ë²„íƒ€ì„ì´ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
      setShowOvertimeModal(false);
      setEditingOvertime(null);
      loadData();
    } catch (error) {
      console.error('ì˜¤ë²„íƒ€ì„ ìˆ˜ì • ì˜¤ë¥˜:', error);
      alert('ì˜¤ë²„íƒ€ì„ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
  };

  const generateEmployeeReport = () => {
    const currentMonth = new Date().getMonth() + 1;
    const currentYear = new Date().getFullYear();
    
    // ë¶€ì„œë³„ í†µê³„
    const departmentStats = employees.reduce((acc, emp) => {
      if (!acc[emp.department]) {
        acc[emp.department] = { count: 0, totalSalary: 0, active: 0, inactive: 0 };
      }
      acc[emp.department].count++;
      acc[emp.department].totalSalary += Number(emp.monthly_salary);
      if (emp.status === 'ACTIVE') {
        acc[emp.department].active++;
      } else {
        acc[emp.department].inactive++;
      }
      return acc;
    }, {} as any);

    // ì´ë²ˆ ë‹¬ ì…ì‚¬/í‡´ì‚¬ í†µê³„
    const newEmployeesThisMonth = employees.filter(emp => {
      const startDate = new Date(emp.start_date);
      return startDate.getMonth() + 1 === currentMonth && startDate.getFullYear() === currentYear;
    });

    let reportContent = `
      ì§ì› ê´€ë¦¬ ì¢…í•© ë¦¬í¬íŠ¸
      ====================
      ìƒì„±ì¼: ${new Date().toLocaleDateString()}
      ë³´ê³ ê¸°ê°„: ${currentYear}ë…„ ${currentMonth}ì›”
      
      ğŸ“Š ì „ì²´ í˜„í™©
      - ì´ ì§ì›ìˆ˜: ${employees.length}ëª…
      - í™œì„± ì§ì›: ${employees.filter(emp => emp.status === 'ACTIVE').length}ëª…
      - ë¹„í™œì„± ì§ì›: ${employees.filter(emp => emp.status !== 'ACTIVE').length}ëª…
      - ì´ë²ˆ ë‹¬ ì‹ ê·œ ì…ì‚¬: ${newEmployeesThisMonth.length}ëª…
      
      ğŸ’° ê¸‰ì—¬ í˜„í™©
      - ì´ ê¸‰ì—¬ ì§€ì¶œ: â‚©${employees.reduce((sum, emp) => sum + Number(emp.monthly_salary), 0).toLocaleString()}
      - í‰ê·  ê¸‰ì—¬: â‚©${(employees.reduce((sum, emp) => sum + Number(emp.monthly_salary), 0) / employees.length).toLocaleString()}
      
      ğŸ¢ ë¶€ì„œë³„ í˜„í™©
    `;

    Object.entries(departmentStats).forEach(([dept, stats]: [string, any]) => {
      reportContent += `
      ${dept} ë¶€ì„œ:
      - ì§ì›ìˆ˜: ${stats.count}ëª… (í™œì„±: ${stats.active}ëª…, ë¹„í™œì„±: ${stats.inactive}ëª…)
      - ì´ ê¸‰ì—¬: â‚©${stats.totalSalary.toLocaleString()}
      - í‰ê·  ê¸‰ì—¬: â‚©${(stats.totalSalary / stats.count).toLocaleString()}
      `;
    });

    reportContent += `
      
      ğŸ‘¥ ì‹ ê·œ ì…ì‚¬ ì§ì› (ì´ë²ˆ ë‹¬)
    `;

    newEmployeesThisMonth.forEach(emp => {
      reportContent += `
      - ${emp.nick_name} (${emp.employee_code})
        ë¶€ì„œ: ${emp.department}
        ê¸‰ì—¬: â‚©${emp.monthly_salary.toLocaleString()}
        ì…ì‚¬ì¼: ${emp.start_date}
      `;
    });

    // ìƒˆ ì°½ì—ì„œ ë³´ê³ ì„œ ì¶œë ¥
    const newWindow = window.open('', '_blank');
    if (newWindow) {
      newWindow.document.write(`
        <html>
          <head>
            <title>ì§ì› ê´€ë¦¬ ì¢…í•© ë¦¬í¬íŠ¸</title>
            <style>
              body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
              .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
              .content { white-space: pre-line; font-family: monospace; font-size: 14px; }
              .footer { margin-top: 30px; text-align: center; border-top: 1px solid #ccc; padding-top: 20px; }
              .section { margin: 20px 0; }
              .highlight { background-color: #f0f0f0; padding: 10px; border-radius: 5px; }
              @media print {
                body { margin: 0; }
                .no-print { display: none; }
              }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>ì§ì› ê´€ë¦¬ ì¢…í•© ë¦¬í¬íŠ¸</h1>
              <p>${currentYear}ë…„ ${currentMonth}ì›”</p>
            </div>
            <div class="content">${reportContent}</div>
            <div class="footer">
              <p>ìƒì„±ì¼: ${new Date().toLocaleDateString()}</p>
              <button class="no-print" onclick="window.print()">ì¸ì‡„</button>
              <button class="no-print" onclick="window.close()">ë‹«ê¸°</button>
            </div>
          </body>
        </html>
      `);
      newWindow.document.close();
    }
  };

  const generateDashboardReport = () => {
    const currentMonth = new Date().getMonth() + 1;
    const currentYear = new Date().getFullYear();
    
    // ì›”ë³„ í†µê³„ ê³„ì‚°
    const newEmployeesThisMonth = employees.filter(emp => {
      const hireDate = new Date(emp.hire_date);
      return hireDate.getMonth() + 1 === currentMonth && hireDate.getFullYear() === currentYear;
    }).length;
    
    const leftEmployeesThisMonth = employees.filter(emp => {
      if (!emp.termination_date) return false;
      const terminationDate = new Date(emp.termination_date);
      return terminationDate.getMonth() + 1 === currentMonth && terminationDate.getFullYear() === currentYear;
    }).length;
    
    const overtimeAmountThisMonth = overtimeData
      .filter(ot => {
        const overtimeDate = new Date(ot.overtime_date);
        return overtimeDate.getMonth() + 1 === currentMonth && 
               overtimeDate.getFullYear() === currentYear &&
               ot.status === 'APPROVED';
      })
      .reduce((sum, ot) => {
        const employee = ot.employees as any;
        const hourlyRate = employee?.hourly_rate || 0;
        return sum + (ot.overtime_hours * hourlyRate);
      }, 0);
    
    const overtimeAmountThisYear = overtimeData
      .filter(ot => {
        const overtimeDate = new Date(ot.overtime_date);
        return overtimeDate.getFullYear() === currentYear && ot.status === 'APPROVED';
      })
      .reduce((sum, ot) => {
        const employee = ot.employees as any;
        const hourlyRate = employee?.hourly_rate || 0;
        return sum + (ot.overtime_hours * hourlyRate);
      }, 0);
    
    const lastMonth = currentMonth === 1 ? 12 : currentMonth - 1;
    const lastMonthYear = currentMonth === 1 ? currentYear - 1 : currentYear;
    const lastMonthPayroll = payrollData.filter(payroll => {
      const payrollDate = new Date(payroll.pay_period_start);
      return payrollDate.getMonth() + 1 === lastMonth && payrollDate.getFullYear() === lastMonthYear;
    });
    const lastMonthTotal = lastMonthPayroll.reduce((sum, payroll) => {
      const net = payroll.base_salary + 
                 (payroll.total_overtime_hours * payroll.overtime_rate) + 
                 payroll.performance_bonus + 
                 payroll.special_bonus + 
                 payroll.position_allowance + 
                 payroll.meal_allowance + 
                 payroll.transport_allowance - 
                 payroll.social_insurance - 
                 payroll.personal_tax - 
                 payroll.advance_salary - 
                 payroll.salary_deduction - 
                 payroll.other_deductions;
      return sum + net;
    }, 0);
    
    const thisYearPayroll = payrollData.filter(payroll => {
      const payrollDate = new Date(payroll.pay_period_start);
      return payrollDate.getFullYear() === currentYear;
    });
    const thisYearTotal = thisYearPayroll.reduce((sum, payroll) => {
      const net = payroll.base_salary + 
                 (payroll.total_overtime_hours * payroll.overtime_rate) + 
                 payroll.performance_bonus + 
                 payroll.special_bonus + 
                 payroll.position_allowance + 
                 payroll.meal_allowance + 
                 payroll.transport_allowance - 
                 payroll.social_insurance - 
                 payroll.personal_tax - 
                 payroll.advance_salary - 
                 payroll.salary_deduction - 
                 payroll.other_deductions;
      return sum + net;
    }, 0);

    let reportContent = `
      ëŒ€ì‹œë³´ë“œ ì¢…í•© ë¦¬í¬íŠ¸
      ====================
      ìƒì„±ì¼: ${new Date().toLocaleDateString()}
      ë³´ê³ ê¸°ê°„: ${currentYear}ë…„ ${currentMonth}ì›”
      
      ğŸ“Š ì¸ë ¥ í˜„í™©
      - ì´ ì§ì›ìˆ˜: ${totalEmployees}ëª…
      - ì´ë²ˆ ë‹¬ ì…ì‚¬: ${newEmployeesThisMonth}ëª…
      - ì´ë²ˆ ë‹¬ í‡´ì‚¬: ${leftEmployeesThisMonth}ëª…
      - ìŠ¹ì¸ ëŒ€ê¸°: ${pendingApprovals}ê±´
      
      ğŸ’° ê¸‰ì—¬ í˜„í™©
      - ì´ë²ˆ ë‹¬ ê¸‰ì—¬ì§€ê¸‰ì•¡: â‚©${totalGrossSalary.toLocaleString()}
      - ì§€ë‚œë‹¬ ê¸‰ì—¬ì§€ê¸‰ì•¡: â‚©${lastMonthTotal.toLocaleString()}
      - ì˜¬í•´ ê¸‰ì—¬ ì´ì•¡: â‚©${thisYearTotal.toLocaleString()}
      
      â° ì˜¤ë²„íƒ€ì„ í˜„í™©
      - ì´ë²ˆ ë‹¬ ì˜¤ë²„íƒ€ì„: ${totalOvertimeHours}ì‹œê°„
      - ì´ë²ˆ ë‹¬ ì˜¤ë²„íƒ€ì„ ê¸ˆì•¡: â‚©${overtimeAmountThisMonth.toLocaleString()}
      - ì˜¬í•´ ì˜¤ë²„íƒ€ì„ ëˆ„ì ê¸ˆì•¡: â‚©${overtimeAmountThisYear.toLocaleString()}
      
      ğŸ“ˆ ë¶€ì„œë³„ í˜„í™©
    `;

    // ë¶€ì„œë³„ í†µê³„ ì¶”ê°€
    const departments = ['IT', 'HR', 'Finance'];
    departments.forEach(dept => {
      const deptEmployees = employees.filter(emp => emp.department === dept);
      const deptPayroll = payrollData.filter(payroll => {
        const employee = payroll.employees as any;
        return employee?.department === dept;
      });
      const deptTotal = deptPayroll.reduce((sum, payroll) => {
        const net = payroll.base_salary + 
                   (payroll.total_overtime_hours * payroll.overtime_rate) + 
                   payroll.performance_bonus + 
                   payroll.special_bonus + 
                   payroll.position_allowance + 
                   payroll.meal_allowance + 
                   payroll.transport_allowance - 
                   payroll.social_insurance - 
                   payroll.personal_tax - 
                   payroll.advance_salary - 
                   payroll.salary_deduction - 
                   payroll.other_deductions;
        return sum + net;
      }, 0);
      
      reportContent += `
      ${dept} ë¶€ì„œ:
      - ì§ì›ìˆ˜: ${deptEmployees.length}ëª…
      - ê¸‰ì—¬ ì´ì•¡: â‚©${deptTotal.toLocaleString()}
      `;
    });

    // ìƒˆ ì°½ì—ì„œ ë³´ê³ ì„œ ì¶œë ¥
    const newWindow = window.open('', '_blank');
    if (newWindow) {
      newWindow.document.write(`
        <html>
          <head>
            <title>ëŒ€ì‹œë³´ë“œ ì¢…í•© ë¦¬í¬íŠ¸</title>
            <style>
              body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
              .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #333; padding-bottom: 20px; }
              .content { white-space: pre-line; font-family: monospace; font-size: 14px; }
              .footer { margin-top: 30px; text-align: center; border-top: 1px solid #ccc; padding-top: 20px; }
              .section { margin: 20px 0; }
              .highlight { background-color: #f0f0f0; padding: 10px; border-radius: 5px; }
              @media print {
                body { margin: 0; }
                .no-print { display: none; }
              }
            </style>
          </head>
          <body>
            <div class="header">
              <h1>ëŒ€ì‹œë³´ë“œ ì¢…í•© ë¦¬í¬íŠ¸</h1>
              <p>${currentYear}ë…„ ${currentMonth}ì›”</p>
            </div>
            <div class="content">${reportContent}</div>
            <div class="footer">
              <p>ìƒì„±ì¼: ${new Date().toLocaleDateString()}</p>
              <button class="no-print" onclick="window.print()">ì¸ì‡„</button>
              <button class="no-print" onclick="window.close()">ë‹«ê¸°</button>
            </div>
          </body>
        </html>
      `);
      newWindow.document.close();
    }
  };

  const Sidebar = () => (
    <div className={`${sidebarOpen ? 'w-64' : 'w-16'} bg-gray-900 min-h-screen transition-all duration-300 fixed left-0 top-0 z-10`}>
      <div className="p-4">
        <div className="flex items-center justify-between">
          <div className={`flex items-center ${!sidebarOpen && 'hidden'}`}>
            {companySettings?.logo_url ? (
              <img 
                src={companySettings.logo_url} 
                alt="Company Logo" 
                className="w-8 h-8 mr-2 rounded"
              />
            ) : (
              <div className="w-8 h-8 bg-pink-500 rounded-lg flex items-center justify-center mr-2">
                <span className="text-white font-bold text-sm">ğŸ’¼</span>
              </div>
            )}
            <h1 className="text-white font-bold text-xl">
              {companySettings?.company_name || 'ê¸‰ì—¬ê´€ë¦¬'}
            </h1>
          </div>
          <button 
            onClick={() => setSidebarOpen(!sidebarOpen)}
            className="text-white hover:bg-gray-800 p-2 rounded"
          >
            <Menu size={20} />
          </button>
        </div>
      </div>
      
      <nav className="mt-8">
        {[
          { id: 'dashboard', label: 'ëŒ€ì‹œë³´ë“œ', icon: Home },
          { id: 'payroll', label: 'ê¸‰ì—¬ê´€ë¦¬', icon: DollarSign },
          { id: 'overtime', label: 'ì˜¤ë²„íƒ€ì„', icon: Clock },
          { id: 'employees', label: 'ì§ì›ê´€ë¦¬', icon: Users },
          { id: 'reports', label: 'ë³´ê³ ì„œ', icon: FileText },
          { id: 'settings', label: 'ì„¤ì •', icon: Settings }
        ].map(item => {
          const Icon = item.icon;
          return (
            <button
              key={item.id}
              onClick={() => setCurrentView(item.id)}
              className={`w-full flex items-center px-4 py-3 text-left hover:bg-gray-800 transition-colors ${
                currentView === item.id ? 'bg-gray-800 border-r-4 border-blue-500' : ''
              }`}
            >
              <Icon className="text-white" size={20} />
              <span className={`text-white ml-3 ${!sidebarOpen && 'hidden'}`}>
                {item.label}
              </span>
            </button>
          );
        })}
      </nav>
      
      <div className="absolute bottom-0 w-full p-4">
        <button className="w-full flex items-center px-4 py-3 text-left hover:bg-gray-800 transition-colors">
          <LogOut className="text-white" size={20} />
          <span className={`text-white ml-3 ${!sidebarOpen && 'hidden'}`}>
            ë¡œê·¸ì•„ì›ƒ
          </span>
        </button>
      </div>
    </div>
  );

  const StatCard = ({ title, value, icon: Icon, trend }: any) => (
    <div className="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
      <div className="flex items-center justify-between">
        <div>
          <p className="text-sm font-medium text-gray-600 mb-1">{title}</p>
          <p className="text-2xl font-semibold text-gray-900">{value}</p>
          {trend && (
            <p className="text-sm text-green-600 mt-1">
              <TrendingUp className="inline w-4 h-4 mr-1" />
              {trend}
            </p>
          )}
        </div>
        <div className="bg-blue-50 p-3 rounded-full">
          <Icon className="text-blue-600" size={24} />
        </div>
      </div>
    </div>
  );

  const DashboardView = () => {
    // ì›”ë³„ í†µê³„ ê³„ì‚°
    const currentMonth = new Date().getMonth() + 1;
    const currentYear = new Date().getFullYear();
    
    // ì´ë²ˆ ë‹¬ ì…ì‚¬í•œ ì§ì›ìˆ˜
    const newEmployeesThisMonth = employees.filter(emp => {
      const hireDate = new Date(emp.hire_date);
      return hireDate.getMonth() + 1 === currentMonth && hireDate.getFullYear() === currentYear;
    }).length;
    
    // ì´ë²ˆ ë‹¬ í‡´ì‚¬í•œ ì§ì›ìˆ˜
    const leftEmployeesThisMonth = employees.filter(emp => {
      if (!emp.termination_date) return false;
      const terminationDate = new Date(emp.termination_date);
      return terminationDate.getMonth() + 1 === currentMonth && terminationDate.getFullYear() === currentYear;
    }).length;
    
    // ì´ë²ˆ ë‹¬ ì˜¤ë²„íƒ€ì„ ëˆ„ì ê¸ˆì•¡
    const overtimeAmountThisMonth = overtimeData
      .filter(ot => {
        const overtimeDate = new Date(ot.overtime_date);
        return overtimeDate.getMonth() + 1 === currentMonth && 
               overtimeDate.getFullYear() === currentYear &&
               ot.status === 'APPROVED';
      })
      .reduce((sum, ot) => {
        const employee = ot.employees as any;
        const hourlyRate = employee?.hourly_rate || 0;
        return sum + (ot.overtime_hours * hourlyRate);
      }, 0);
    
    // ì˜¬í•´ ì˜¤ë²„íƒ€ì„ ëˆ„ì ê¸ˆì•¡
    const overtimeAmountThisYear = overtimeData
      .filter(ot => {
        const overtimeDate = new Date(ot.overtime_date);
        return overtimeDate.getFullYear() === currentYear && ot.status === 'APPROVED';
      })
      .reduce((sum, ot) => {
        const employee = ot.employees as any;
        const hourlyRate = employee?.hourly_rate || 0;
        return sum + (ot.overtime_hours * hourlyRate);
      }, 0);
    
    // ì§€ë‚œë‹¬ ê¸‰ì—¬ ì´ì•¡
    const lastMonth = currentMonth === 1 ? 12 : currentMonth - 1;
    const lastMonthYear = currentMonth === 1 ? currentYear - 1 : currentYear;
    const lastMonthPayroll = payrollData.filter(payroll => {
      const payrollDate = new Date(payroll.pay_period_start);
      return payrollDate.getMonth() + 1 === lastMonth && payrollDate.getFullYear() === lastMonthYear;
    });
    const lastMonthTotal = lastMonthPayroll.reduce((sum, payroll) => {
      const net = payroll.base_salary + 
                 (payroll.total_overtime_hours * payroll.overtime_rate) + 
                 payroll.performance_bonus + 
                 payroll.special_bonus + 
                 payroll.position_allowance + 
                 payroll.meal_allowance + 
                 payroll.transport_allowance - 
                 payroll.social_insurance - 
                 payroll.personal_tax - 
                 payroll.advance_salary - 
                 payroll.salary_deduction - 
                 payroll.other_deductions;
      return sum + net;
    }, 0);
    
    // ì˜¬í•´ ê¸‰ì—¬ ì´ì•¡
    const thisYearPayroll = payrollData.filter(payroll => {
      const payrollDate = new Date(payroll.pay_period_start);
      return payrollDate.getFullYear() === currentYear;
    });
    const thisYearTotal = thisYearPayroll.reduce((sum, payroll) => {
      const net = payroll.base_salary + 
                 (payroll.total_overtime_hours * payroll.overtime_rate) + 
                 payroll.performance_bonus + 
                 payroll.special_bonus + 
                 payroll.position_allowance + 
                 payroll.meal_allowance + 
                 payroll.transport_allowance - 
                 payroll.social_insurance - 
                 payroll.personal_tax - 
                 payroll.advance_salary - 
                 payroll.salary_deduction - 
                 payroll.other_deductions;
      return sum + net;
    }, 0);

    return (
      <div className="space-y-6">
        <div className="flex items-center justify-between">
          <h2 className="text-2xl font-semibold text-gray-900">ëŒ€ì‹œë³´ë“œ</h2>
          <div className="flex items-center space-x-4">
            <div className="flex items-center space-x-2">
              <Calendar size={20} className="text-gray-500" />
              <span className="text-gray-600">{selectedYear}ë…„ {selectedMonth}</span>
            </div>
            <button
              onClick={() => generateDashboardReport()}
              className="flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
            >
              <FileText size={16} />
              <span>ëŒ€ì‹œë³´ë“œ ë¦¬í¬íŠ¸</span>
            </button>
          </div>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <StatCard 
            title="ì´ ì§ì›ìˆ˜" 
            value={totalEmployees}
            icon={Users}
            trend={`+${newEmployeesThisMonth} ì…ì‚¬, -${leftEmployeesThisMonth} í‡´ì‚¬`}
          />
          <StatCard 
            title="ì´ë²ˆ ë‹¬ ê¸‰ì—¬ì§€ê¸‰ì•¡" 
            value={`â‚©${totalGrossSalary.toLocaleString()}`}
            icon={DollarSign}
            trend={`ì§€ë‚œë‹¬: â‚©${lastMonthTotal.toLocaleString()}`}
          />
          <StatCard 
            title="ì´ë²ˆ ë‹¬ ì˜¤ë²„íƒ€ì„" 
            value={`${totalOvertimeHours}ì‹œê°„`}
            icon={Clock}
            trend={`â‚©${overtimeAmountThisMonth.toLocaleString()}`}
          />
          <StatCard 
            title="ìŠ¹ì¸ ëŒ€ê¸°" 
            value={pendingApprovals}
            icon={FileText}
            trend="2 pending"
          />
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <StatCard 
            title="ì´ë²ˆ ë‹¬ ì…ì‚¬" 
            value={newEmployeesThisMonth}
            icon={UserPlus}
            trend="ì‹ ê·œ ì±„ìš©"
          />
          <StatCard 
            title="ì´ë²ˆ ë‹¬ í‡´ì‚¬" 
            value={leftEmployeesThisMonth}
            icon={UserMinus}
            trend="ì¸ë ¥ ê°ì†Œ"
          />
          <StatCard 
            title="ì˜¬í•´ ì˜¤ë²„íƒ€ì„ ëˆ„ì " 
            value={`â‚©${overtimeAmountThisYear.toLocaleString()}`}
            icon={Clock}
            trend="ì—°ê°„ ëˆ„ì "
          />
          <StatCard 
            title="ì˜¬í•´ ê¸‰ì—¬ ì´ì•¡" 
            value={`â‚©${thisYearTotal.toLocaleString()}`}
            icon={DollarSign}
            trend="ì—°ê°„ ëˆ„ì "
          />
        </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div className="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
          <h3 className="text-lg font-semibold mb-4">ë¶€ì„œë³„ ê¸‰ì—¬ í˜„í™©</h3>
          <div className="space-y-4">
            {['IT', 'HR', 'Finance'].map(dept => {
              const deptData = payrollData.filter(emp => {
                const employee = emp.employees as any;
                return employee?.department === dept;
              });
              const deptTotal = deptData.reduce((sum, emp) => {
                const net = emp.base_salary + 
                           (emp.total_overtime_hours * emp.overtime_rate) + 
                           emp.performance_bonus + 
                           emp.special_bonus + 
                           emp.position_allowance + 
                           emp.meal_allowance + 
                           emp.transport_allowance - 
                           emp.social_insurance - 
                           emp.personal_tax - 
                           emp.advance_salary - 
                           emp.salary_deduction - 
                           emp.other_deductions;
                return sum + net;
              }, 0);
              const percentage = totalGrossSalary > 0 ? (deptTotal / totalGrossSalary * 100).toFixed(1) : '0';
              
              return (
                <div key={dept} className="flex items-center justify-between">
                  <div className="flex items-center">
                    <Building size={16} className="text-gray-500 mr-2" />
                    <span className="font-medium">{dept}</span>
                  </div>
                  <div className="text-right">
                    <p className="font-semibold">â‚©{deptTotal.toLocaleString()}</p>
                    <p className="text-sm text-gray-500">{percentage}%</p>
                  </div>
                </div>
              );
            })}
          </div>
        </div>

        <div className="bg-white rounded-lg p-6 shadow-sm border border-gray-200">
          <h3 className="text-lg font-semibold mb-4">ìµœê·¼ ì˜¤ë²„íƒ€ì„ í˜„í™©</h3>
          <div className="space-y-3">
            {overtimeData.slice(0, 5).map(ot => {
              const employee = ot.employees as any;
              return (
                <div key={ot.id} className="flex items-center justify-between py-2 border-b border-gray-100 last:border-b-0">
                  <div className="flex items-center">
                    <User size={16} className="text-gray-500 mr-2" />
                    <div>
                      <p className="font-medium text-sm">{employee?.nick_name}</p>
                      <p className="text-xs text-gray-500">{ot.overtime_date}</p>
                    </div>
                  </div>
                  <div className="text-right">
                    <p className="font-semibold text-sm">{ot.overtime_hours}ì‹œê°„</p>
                    <span className={`text-xs px-2 py-1 rounded ${
                      ot.status === 'APPROVED' ? 'bg-green-100 text-green-800' :
                      ot.status === 'PENDING' ? 'bg-yellow-100 text-yellow-800' :
                      'bg-red-100 text-red-800'
                    }`}>
                      {ot.status}
                    </span>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      </div>
    </div>
  );

  const PayrollView = () => (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h2 className="text-2xl font-semibold text-gray-900">ê¸‰ì—¬ ê´€ë¦¬</h2>
        <div className="flex items-center space-x-3">
          <button
            onClick={() => generatePayrollReport()}
            className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
          >
            <FileText size={16} />
            <span>ê¸‰ì—¬ ë¦¬í¬íŠ¸</span>
          </button>
          <button 
            onClick={() => setShowPayrollModal(true)}
            className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center"
          >
            <Plus size={20} className="mr-2" />
            ìƒˆ ê¸‰ì—¬ëª…ì„¸ì„œ
          </button>
        </div>
      </div>

      {/* ê¸‰ì—¬ëª…ì„¸ì„œê°€ ì—†ëŠ” ì§ì›ë“¤ ì•ˆë‚´ */}
      {employeesWithoutPayroll.length > 0 && (
        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
          <div className="flex items-center">
            <div className="flex-shrink-0">
              <svg className="h-5 w-5 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
                <path fillRule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
              </svg>
            </div>
            <div className="ml-3">
              <h3 className="text-sm font-medium text-yellow-800">
                ê¸‰ì—¬ëª…ì„¸ì„œê°€ ì—†ëŠ” ì§ì›ì´ ìˆìŠµë‹ˆë‹¤
              </h3>
              <div className="mt-2 text-sm text-yellow-700">
                <p>
                  ë‹¤ìŒ {employeesWithoutPayroll.length}ëª…ì˜ ì§ì›ì— ëŒ€í•œ ê¸‰ì—¬ëª…ì„¸ì„œë¥¼ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤:
                </p>
                <ul className="mt-1 list-disc list-inside">
                  {employeesWithoutPayroll.slice(0, 3).map(emp => (
                    <li key={emp.id}>
                      {emp.nick_name} ({emp.employee_code}) - {emp.department}
                    </li>
                  ))}
                  {employeesWithoutPayroll.length > 3 && (
                    <li>... ë° {employeesWithoutPayroll.length - 3}ëª… ë”</li>
                  )}
                </ul>
                <p className="mt-2">
                  <strong>"ìƒˆ ê¸‰ì—¬ëª…ì„¸ì„œ"</strong> ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ê¸‰ì—¬ëª…ì„¸ì„œë¥¼ ìƒì„±í•˜ì„¸ìš”.
                </p>
              </div>
            </div>
          </div>
        </div>
      )}

      <div className="bg-white rounded-lg shadow-sm border border-gray-200">
        <div className="p-6 border-b border-gray-200">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-4">
              <div className="relative">
                <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" size={20} />
                <input
                  type="text"
                  placeholder="ì§ì› ê²€ìƒ‰..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"
                />
              </div>
              <button className="flex items-center px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                <Filter size={16} className="mr-2" />
                í•„í„°
              </button>
            </div>
            <div className="flex items-center space-x-2">
              <select 
                value={selectedMonth} 
                onChange={(e) => setSelectedMonth(e.target.value)}
                className="border border-gray-300 rounded-lg px-3 py-2"
              >
                <option value="JANUARY">1ì›”</option>
                <option value="FEBRUARY">2ì›”</option>
                <option value="MARCH">3ì›”</option>
                <option value="APRIL">4ì›”</option>
                <option value="MAY">5ì›”</option>
                <option value="JUNE">6ì›”</option>
                <option value="JULY">7ì›”</option>
                <option value="AUGUST">8ì›”</option>
                <option value="SEPTEMBER">9ì›”</option>
                <option value="OCTOBER">10ì›”</option>
                <option value="NOVEMBER">11ì›”</option>
                <option value="DECEMBER">12ì›”</option>
              </select>
              <select 
                value={selectedYear} 
                onChange={(e) => setSelectedYear(Number(e.target.value))}
                className="border border-gray-300 rounded-lg px-3 py-2"
              >
                <option value={2024}>2024</option>
                <option value={2025}>2025</option>
                <option value={2026}>2026</option>
              </select>
            </div>
          </div>
        </div>

        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì§ì›</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë¶€ì„œ</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ê¸°ë³¸ê¸‰</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì˜¤ë²„íƒ€ì„</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë³´ë„ˆìŠ¤</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì´ ê¸‰ì—¬</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ê³µì œ</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì‹¤ìˆ˜ë ¹ì•¡</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ìƒíƒœ</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì•¡ì…˜</th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {filteredPayrollData.map(emp => {
                const employee = emp.employees as any;
                const grossSalary = emp.base_salary + 
                                   (emp.total_overtime_hours * emp.overtime_rate) + 
                                   emp.performance_bonus + 
                                   emp.special_bonus + 
                                   emp.position_allowance + 
                                   emp.meal_allowance + 
                                   emp.transport_allowance;
                const totalDeductions = emp.social_insurance + 
                                       emp.personal_tax + 
                                       emp.advance_salary + 
                                       emp.salary_deduction + 
                                       emp.other_deductions;
                const netSalary = grossSalary - totalDeductions;

                return (
                  <tr key={emp.id} className="hover:bg-gray-50">
                    <td className="px-6 py-4 whitespace-nowrap">
                      <div className="flex items-center">
                        <div className="flex-shrink-0 h-10 w-10">
                          <div className="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                            <span className="text-sm font-medium text-blue-600">
                              {employee?.nick_name?.charAt(0)}
                            </span>
                          </div>
                        </div>
                        <div className="ml-4">
                          <div className="text-sm font-medium text-gray-900">{employee?.nick_name}</div>
                          <div className="text-sm text-gray-500">{employee?.employee_code}</div>
                        </div>
                      </div>
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{employee?.department}</td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">â‚©{emp.base_salary.toLocaleString()}</td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      {emp.total_overtime_hours}ì‹œê°„ (â‚©{(emp.total_overtime_hours * emp.overtime_rate).toLocaleString()})
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      â‚©{(emp.performance_bonus + emp.special_bonus).toLocaleString()}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">â‚©{grossSalary.toLocaleString()}</td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">â‚©{totalDeductions.toLocaleString()}</td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm font-bold text-blue-600">â‚©{netSalary.toLocaleString()}</td>
                    <td className="px-6 py-4 whitespace-nowrap">
                      <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                        emp.status === 'APPROVED' ? 'bg-green-100 text-green-800' :
                        emp.status === 'PENDING' ? 'bg-yellow-100 text-yellow-800' :
                        emp.status === 'DRAFT' ? 'bg-gray-100 text-gray-800' :
                        'bg-blue-100 text-blue-800'
                      }`}>
                        {emp.status}
                      </span>
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                      <div className="flex space-x-2">
                        <button 
                          onClick={() => {
                            setEditingPayroll(emp);
                            setShowPayrollModal(true);
                          }}
                          className="text-blue-600 hover:text-blue-900"
                          title="ìƒì„¸ë³´ê¸°"
                        >
                          <Eye size={16} />
                        </button>
                        <button 
                          onClick={() => {
                            setEditingPayroll(emp);
                            setShowPayrollModal(true);
                          }}
                          className="text-green-600 hover:text-green-900"
                          title="ìˆ˜ì •"
                        >
                          <Edit size={16} />
                        </button>
                        {emp.status === 'PENDING' && (
                          <>
                            <button 
                              onClick={() => handlePayrollStatusChange(emp.id, 'APPROVED')}
                              className="text-green-600 hover:text-green-900"
                              title="ìŠ¹ì¸"
                            >
                              <Check size={16} />
                            </button>
                            <button 
                              onClick={() => handlePayrollStatusChange(emp.id, 'REJECTED')}
                              className="text-red-600 hover:text-red-900"
                              title="ë°˜ë ¤"
                            >
                              <X size={16} />
                            </button>
                          </>
                        )}
                      </div>
                    </td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );

  const OvertimeView = () => (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h2 className="text-2xl font-semibold text-gray-900">ì˜¤ë²„íƒ€ì„ ê´€ë¦¬</h2>
        <div className="flex items-center space-x-3">
          <button
            onClick={() => generateOvertimeReport()}
            className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
          >
            <FileText size={16} />
            <span>ì˜¤ë²„íƒ€ì„ ë¦¬í¬íŠ¸</span>
          </button>
          <button 
            onClick={() => setShowOvertimeModal(true)}
            className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center"
          >
            <Plus size={20} className="mr-2" />
            ì˜¤ë²„íƒ€ì„ ë“±ë¡
          </button>
        </div>
      </div>

      <div className="bg-white rounded-lg shadow-sm border border-gray-200">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì§ì›</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë‚ ì§œ</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì‹œê°„</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì—…ë¬´ ë‚´ìš©</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ìš°ì„ ìˆœìœ„</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ìƒíƒœ</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì•¡ì…˜</th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {overtimeData.map(ot => {
                const employee = ot.employees as any;
                return (
                  <tr key={ot.id} className="hover:bg-gray-50">
                    <td className="px-6 py-4 whitespace-nowrap">
                      <div className="flex items-center">
                        <div className="flex-shrink-0 h-10 w-10">
                          <div className="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                            <span className="text-sm font-medium text-blue-600">
                              {employee?.nick_name?.charAt(0)}
                            </span>
                          </div>
                        </div>
                        <div className="ml-4">
                          <div className="text-sm font-medium text-gray-900">{employee?.nick_name}</div>
                          <div className="text-sm text-gray-500">{employee?.employee_code}</div>
                        </div>
                      </div>
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{ot.overtime_date}</td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      {ot.start_time} - {ot.end_time} ({ot.overtime_hours}ì‹œê°„)
                    </td>
                    <td className="px-6 py-4 text-sm text-gray-900">{ot.work_description}</td>
                    <td className="px-6 py-4 whitespace-nowrap">
                      <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                        ot.priority === 'HIGH' ? 'bg-red-100 text-red-800' :
                        ot.priority === 'MEDIUM' ? 'bg-yellow-100 text-yellow-800' :
                        'bg-green-100 text-green-800'
                      }`}>
                        {ot.priority}
                      </span>
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap">
                      <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                        ot.status === 'APPROVED' ? 'bg-green-100 text-green-800' :
                        ot.status === 'PENDING' ? 'bg-yellow-100 text-yellow-800' :
                        'bg-red-100 text-red-800'
                      }`}>
                        {ot.status}
                      </span>
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                      {ot.status === 'PENDING' && (
                        <div className="flex space-x-2">
                          <button 
                            onClick={() => handleOvertimeAction(ot.id, 'APPROVE')}
                            className="text-green-600 hover:text-green-900"
                          >
                            <Check size={16} />
                          </button>
                          <button 
                            onClick={() => handleOvertimeAction(ot.id, 'REJECT')}
                            className="text-red-600 hover:text-red-900"
                          >
                            <X size={16} />
                          </button>
                        </div>
                      )}
                    </td>
                  </tr>
                );
              })}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );

  const EmployeesView = () => (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <h2 className="text-2xl font-semibold text-gray-900">ì§ì› ê´€ë¦¬</h2>
        <div className="flex items-center space-x-3">
          <button
            onClick={() => generateEmployeeReport()}
            className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors"
          >
            <FileText size={16} />
            <span>ì§ì› ë¦¬í¬íŠ¸</span>
          </button>
          <button 
            onClick={() => setShowEmployeeModal(true)}
            className="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center"
          >
            <Plus size={20} className="mr-2" />
            ìƒˆ ì§ì› ë“±ë¡
          </button>
        </div>
      </div>

      <div className="bg-white rounded-lg shadow-sm border border-gray-200">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50">
              <tr>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì§ì›</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ë¶€ì„œ</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì…ì‚¬ì¼</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì›”ê¸‰</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì„±ê³¼í‰ê°€</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ìƒíƒœ</th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì•¡ì…˜</th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {employees.map(emp => (
                <tr key={emp.id} className="hover:bg-gray-50">
                  <td className="px-6 py-4 whitespace-nowrap">
                    <div className="flex items-center">
                      <div className="flex-shrink-0 h-10 w-10">
                        <div className="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                          <span className="text-sm font-medium text-blue-600">
                            {emp.nick_name.charAt(0)}
                          </span>
                        </div>
                      </div>
                      <div className="ml-4">
                        <div className="text-sm font-medium text-gray-900">{emp.nick_name}</div>
                        <div className="text-sm text-gray-500">{emp.employee_code}</div>
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{emp.department}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{emp.start_date}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">â‚©{emp.monthly_salary.toLocaleString()}</td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{emp.performance_rating}</td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                      emp.status === 'ACTIVE' ? 'bg-green-100 text-green-800' :
                      emp.status === 'INACTIVE' ? 'bg-yellow-100 text-yellow-800' :
                      'bg-red-100 text-red-800'
                    }`}>
                      {emp.status}
                    </span>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <div className="flex space-x-2">
                      <button 
                        onClick={() => {
                          setEditingEmployee(emp);
                          setShowEmployeeModal(true);
                        }}
                        className="text-blue-600 hover:text-blue-900"
                        title="ìƒì„¸ë³´ê¸°"
                      >
                        <Eye size={16} />
                      </button>
                      <button 
                        onClick={() => {
                          setEditingEmployee(emp);
                          setShowEmployeeModal(true);
                        }}
                        className="text-green-600 hover:text-green-900"
                        title="ìˆ˜ì •"
                      >
                        <Edit size={16} />
                      </button>
                      {emp.status === 'ACTIVE' && (
                        <button 
                          onClick={() => handleEmployeeStatusChange(emp.id, 'INACTIVE')}
                          className="text-yellow-600 hover:text-yellow-900"
                          title="ë¹„í™œì„±í™”"
                        >
                          <X size={16} />
                        </button>
                      )}
                      {emp.status === 'INACTIVE' && (
                        <button 
                          onClick={() => handleEmployeeStatusChange(emp.id, 'ACTIVE')}
                          className="text-green-600 hover:text-green-900"
                          title="í™œì„±í™”"
                        >
                          <Check size={16} />
                        </button>
                      )}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );

  const SettingsView = () => {
    const [showAdminModal, setShowAdminModal] = useState(false);
    const [showLogoModal, setShowLogoModal] = useState(false);
    const [newAdmin, setNewAdmin] = useState({
      username: '',
      password: '',
      full_name: '',
      email: '',
      role: 'HR_ADMIN',
      department: ''
    });
    const [logoFile, setLogoFile] = useState<File | null>(null);
    const [logoPreview, setLogoPreview] = useState<string>('');

    const handleLogoChange = (e: React.ChangeEvent<HTMLInputElement>) => {
      const file = e.target.files?.[0];
      if (file) {
        setLogoFile(file);
        const reader = new FileReader();
        reader.onload = (e) => {
          setLogoPreview(e.target?.result as string);
        };
        reader.readAsDataURL(file);
      }
    };

    const handleLogoUpload = async () => {
      if (!logoFile) {
        alert('ë¡œê³  íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
      }

      try {
        // íŒŒì¼ í¬ê¸° ì²´í¬ (5MB ì œí•œ)
        if (logoFile.size > 5 * 1024 * 1024) {
          alert('íŒŒì¼ í¬ê¸°ëŠ” 5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
          return;
        }

        // íŒŒì¼ íƒ€ì… ì²´í¬
        if (!logoFile.type.startsWith('image/')) {
          alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
          return;
        }

        // Supabase Storageì— íŒŒì¼ ì—…ë¡œë“œ
        const fileExt = logoFile.name.split('.').pop();
        const fileName = `company-logo-${Date.now()}.${fileExt}`;
        
        const { data: uploadData, error: uploadError } = await supabase.storage
          .from('logos')
          .upload(fileName, logoFile, {
            cacheControl: '3600',
            upsert: false
          });

        if (uploadError) {
          console.error('ë¡œê³  ì—…ë¡œë“œ ì˜¤ë¥˜:', uploadError);
          alert('ë¡œê³  ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          return;
        }

        // ì—…ë¡œë“œëœ íŒŒì¼ì˜ ê³µê°œ URL ê°€ì ¸ì˜¤ê¸°
        const { data: urlData } = supabase.storage
          .from('logos')
          .getPublicUrl(fileName);

        // ë°ì´í„°ë² ì´ìŠ¤ì— ë¡œê³  ì •ë³´ ì €ì¥
        const { error: dbError } = await supabase
          .from('company_settings')
          .upsert({
            id: 1, // ê¸°ë³¸ ì„¤ì • ID
            logo_url: urlData.publicUrl,
            logo_filename: fileName,
            updated_at: new Date().toISOString()
          }, {
            onConflict: 'id'
          });

        if (dbError) {
          console.error('ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥ ì˜¤ë¥˜:', dbError);
          alert('ë¡œê³  ì •ë³´ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          return;
        }

        alert('ë¡œê³ ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
        setShowLogoModal(false);
        setLogoFile(null);
        setLogoPreview('');
        
        // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ìœ¼ë¡œ ë¡œê³  ì—…ë°ì´íŠ¸
        window.location.reload();
        
      } catch (error) {
        console.error('ë¡œê³  ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
        alert('ë¡œê³  ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    };

    const handleAddAdmin = async () => {
      try {
        if (!newAdmin.username || !newAdmin.password || !newAdmin.full_name) {
          alert('í•„ìˆ˜ í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        alert('ê´€ë¦¬ìê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!');
        setShowAdminModal(false);
        setNewAdmin({
          username: '',
          password: '',
          full_name: '',
          email: '',
          role: 'HR_ADMIN',
          department: ''
        });
      } catch (error) {
        alert('ê´€ë¦¬ì ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    };

    return (
      <div className="p-6">
        <div className="mb-6">
          <h1 className="text-3xl font-bold text-gray-900 mb-2">ì„¤ì •</h1>
          <p className="text-gray-600">ì‹œìŠ¤í…œ ì„¤ì • ë° ê´€ë¦¬ì ê´€ë¦¬</p>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {/* ê´€ë¦¬ì ê´€ë¦¬ */}
          <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 className="text-xl font-semibold text-gray-900 mb-4">ê´€ë¦¬ì ê´€ë¦¬</h2>
            <div className="space-y-4">
              <div className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                <div>
                  <p className="font-medium text-gray-900">admin</p>
                  <p className="text-sm text-gray-600">System Administrator</p>
                </div>
                <span className="px-2 py-1 text-xs bg-pink-500 text-white rounded-full">SUPER_ADMIN</span>
              </div>
              <div className="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                <div>
                  <p className="font-medium text-gray-900">hr_admin</p>
                  <p className="text-sm text-gray-600">HR Administrator</p>
                </div>
                <span className="px-2 py-1 text-xs bg-blue-600 text-white rounded-full">HR_ADMIN</span>
              </div>
              <button
                onClick={() => setShowAdminModal(true)}
                className="w-full bg-pink-500 text-white py-2 rounded-lg hover:bg-pink-600 transition-colors"
              >
                ìƒˆ ê´€ë¦¬ì ì¶”ê°€
              </button>
            </div>
          </div>

          {/* ë¡œê³  ì„¤ì • */}
          <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 className="text-xl font-semibold text-gray-900 mb-4">ë¡œê³  ì„¤ì •</h2>
            <div className="space-y-4">
              <div className="flex items-center space-x-4">
                <div className="w-16 h-16 bg-pink-500 rounded-lg flex items-center justify-center">
                  <span className="text-white font-bold text-lg">ğŸ’¼</span>
                </div>
                <div>
                  <p className="font-medium text-gray-900">í˜„ì¬ ë¡œê³ </p>
                  <p className="text-sm text-gray-600">ê¸°ë³¸ ì•„ì´ì½˜</p>
                </div>
              </div>
              <button
                onClick={() => setShowLogoModal(true)}
                className="w-full bg-pink-500 text-white py-2 rounded-lg hover:bg-pink-600 transition-colors"
              >
                ë¡œê³  ë³€ê²½
              </button>
            </div>
          </div>
        </div>

        {/* ê´€ë¦¬ì ì¶”ê°€ ëª¨ë‹¬ */}
        {showAdminModal && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div className="bg-white rounded-lg p-6 w-full max-w-md">
              <h2 className="text-xl font-bold mb-4 text-gray-900">ìƒˆ ê´€ë¦¬ì ì¶”ê°€</h2>
              <div className="space-y-4">
                <input
                  type="text"
                  placeholder="ì‚¬ìš©ìëª…"
                  className="w-full p-2 border rounded text-gray-900"
                  value={newAdmin.username}
                  onChange={(e) => setNewAdmin({...newAdmin, username: e.target.value})}
                />
                <input
                  type="password"
                  placeholder="ë¹„ë°€ë²ˆí˜¸"
                  className="w-full p-2 border rounded text-gray-900"
                  value={newAdmin.password}
                  onChange={(e) => setNewAdmin({...newAdmin, password: e.target.value})}
                />
                <input
                  type="text"
                  placeholder="ì „ì²´ ì´ë¦„"
                  className="w-full p-2 border rounded text-gray-900"
                  value={newAdmin.full_name}
                  onChange={(e) => setNewAdmin({...newAdmin, full_name: e.target.value})}
                />
                <input
                  type="email"
                  placeholder="ì´ë©”ì¼"
                  className="w-full p-2 border rounded text-gray-900"
                  value={newAdmin.email}
                  onChange={(e) => setNewAdmin({...newAdmin, email: e.target.value})}
                />
                <select
                  className="w-full p-2 border rounded text-gray-900"
                  value={newAdmin.role}
                  onChange={(e) => setNewAdmin({...newAdmin, role: e.target.value})}
                >
                  <option value="HR_ADMIN">HR ê´€ë¦¬ì</option>
                  <option value="FINANCE_ADMIN">ì¬ë¬´ ê´€ë¦¬ì</option>
                  <option value="SUPER_ADMIN">ì‹œìŠ¤í…œ ê´€ë¦¬ì</option>
                </select>
                <input
                  type="text"
                  placeholder="ë¶€ì„œ"
                  className="w-full p-2 border rounded text-gray-900"
                  value={newAdmin.department}
                  onChange={(e) => setNewAdmin({...newAdmin, department: e.target.value})}
                />
              </div>
              <div className="flex space-x-2 mt-6">
                <button
                  onClick={handleAddAdmin}
                  className="flex-1 bg-pink-500 text-white py-2 rounded hover:bg-pink-600 transition-colors"
                >
                  ì¶”ê°€
                </button>
                <button
                  onClick={() => setShowAdminModal(false)}
                  className="flex-1 bg-gray-300 text-gray-700 py-2 rounded hover:bg-gray-400"
                >
                  ì·¨ì†Œ
                </button>
              </div>
            </div>
          </div>
        )}

        {/* ë¡œê³  ë³€ê²½ ëª¨ë‹¬ */}
        {showLogoModal && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div className="bg-white rounded-lg p-6 w-full max-w-md">
              <h2 className="text-xl font-bold mb-4 text-gray-900">ë¡œê³  ë³€ê²½</h2>
              <div className="space-y-4">
                <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                  <input
                    type="file"
                    accept="image/*"
                    onChange={handleLogoChange}
                    className="hidden"
                    id="logo-upload"
                  />
                  <label htmlFor="logo-upload" className="cursor-pointer">
                    {logoPreview ? (
                      <img src={logoPreview} alt="ë¡œê³  ë¯¸ë¦¬ë³´ê¸°" className="w-32 h-32 mx-auto object-contain" />
                    ) : (
                      <div>
                        <div className="w-32 h-32 mx-auto bg-gray-100 rounded-lg flex items-center justify-center">
                          <span className="text-gray-400">ğŸ“</span>
                        </div>
                        <p className="mt-2 text-sm text-gray-600">í´ë¦­í•˜ì—¬ ë¡œê³  íŒŒì¼ ì„ íƒ</p>
                      </div>
                    )}
                  </label>
                </div>
                <p className="text-xs text-gray-500">ì§€ì› í˜•ì‹: PNG, JPG, SVG (ìµœëŒ€ 2MB)</p>
              </div>
              <div className="flex space-x-2 mt-6">
                <button
                  onClick={handleLogoUpload}
                  disabled={!logoFile}
                  className="flex-1 bg-pink-500 text-white py-2 rounded hover:bg-pink-600 transition-colors disabled:opacity-50"
                >
                  ì—…ë¡œë“œ
                </button>
                <button
                  onClick={() => setShowLogoModal(false)}
                  className="flex-1 bg-gray-300 text-gray-700 py-2 rounded hover:bg-gray-400"
                >
                  ì·¨ì†Œ
                </button>
              </div>
            </div>
          </div>
        )}
      </div>
    );
  };

  const ReportsView = () => {
    const [selectedEmployee, setSelectedEmployee] = useState<number | null>(null);

    const generatePayrollReport = (employeeId?: number) => {
      const targetData = employeeId 
        ? payrollData.filter(emp => emp.employee_id === employeeId)
        : payrollData;

      let reportContent = `
        ê¸‰ì—¬ëª…ì„¸ì„œ ë³´ê³ ì„œ
        ====================
        ìƒì„±ì¼: ${new Date().toLocaleDateString()}
        ê¸°ê°„: ${selectedYear}ë…„ ${selectedMonth}
        
      `;

      targetData.forEach(emp => {
        const employee = emp.employees as any;
        const grossSalary = emp.base_salary + 
                          (emp.total_overtime_hours * emp.overtime_rate) + 
                          emp.performance_bonus + 
                          emp.special_bonus + 
                          emp.position_allowance + 
                          emp.meal_allowance + 
                          emp.transport_allowance;
        const netSalary = grossSalary - emp.social_insurance - emp.personal_tax - emp.advance_salary - emp.salary_deduction - emp.other_deductions;

        reportContent += `
        ì§ì›: ${employee?.nick_name} (${employee?.employee_code})
        ë¶€ì„œ: ${employee?.department}
        ê¸°ë³¸ê¸‰: à¸¿${emp.base_salary.toLocaleString()}
        ì„±ê³¼ë³´ë„ˆìŠ¤: à¸¿${emp.performance_bonus.toLocaleString()}
        íŠ¹ë³„ë³´ë„ˆìŠ¤: à¸¿${emp.special_bonus.toLocaleString()}
        ì˜¤ë²„íƒ€ì„: ${emp.total_overtime_hours}ì‹œê°„ (à¸¿${(emp.total_overtime_hours * emp.overtime_rate).toLocaleString()})
        ì´ ê¸‰ì—¬: à¸¿${grossSalary.toLocaleString()}
        ì‹¤ìˆ˜ë ¹ì•¡: à¸¿${netSalary.toLocaleString()}
        ìƒíƒœ: ${emp.status}
        ----------------------------------------
        `;
      });

      // ìƒˆ ì°½ì—ì„œ ë³´ê³ ì„œ ì¶œë ¥
      const newWindow = window.open('', '_blank');
      if (newWindow) {
        newWindow.document.write(`
          <html>
            <head>
              <title>ê¸‰ì—¬ëª…ì„¸ì„œ ë³´ê³ ì„œ</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                .header { text-align: center; margin-bottom: 30px; }
                .content { white-space: pre-line; font-family: monospace; }
                .footer { margin-top: 30px; text-align: center; }
                @media print {
                  body { margin: 0; }
                  .no-print { display: none; }
                }
              </style>
            </head>
            <body>
              <div class="header">
                <h1>ê¸‰ì—¬ëª…ì„¸ì„œ ë³´ê³ ì„œ</h1>
                <p>${selectedYear}ë…„ ${selectedMonth}</p>
              </div>
              <div class="content">${reportContent}</div>
              <div class="footer">
                <p>ìƒì„±ì¼: ${new Date().toLocaleDateString()}</p>
                <button class="no-print" onclick="window.print()">ì¸ì‡„</button>
                <button class="no-print" onclick="window.close()">ë‹«ê¸°</button>
              </div>
            </body>
          </html>
        `);
        newWindow.document.close();
      }
    };

    const generateOvertimeReport = () => {
      let reportContent = `
        ì˜¤ë²„íƒ€ì„ ë³´ê³ ì„œ
        ====================
        ìƒì„±ì¼: ${new Date().toLocaleDateString()}
        ê¸°ê°„: ${selectedYear}ë…„ ${selectedMonth}
        
      `;

      overtimeData.forEach(item => {
        const employee = item.employees as any;
        reportContent += `
        ì§ì›: ${employee?.nick_name} (${employee?.employee_code})
        ë‚ ì§œ: ${new Date(item.overtime_date).toLocaleDateString()}
        ì‹œê°„: ${item.start_time} - ${item.end_time} (${item.overtime_hours}ì‹œê°„)
        ì‘ì—…: ${item.work_description}
        ìƒíƒœ: ${item.status}
        ----------------------------------------
        `;
      });

      const newWindow = window.open('', '_blank');
      if (newWindow) {
        newWindow.document.write(`
          <html>
            <head>
              <title>ì˜¤ë²„íƒ€ì„ ë³´ê³ ì„œ</title>
              <style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                .header { text-align: center; margin-bottom: 30px; }
                .content { white-space: pre-line; font-family: monospace; }
                .footer { margin-top: 30px; text-align: center; }
                @media print {
                  body { margin: 0; }
                  .no-print { display: none; }
                }
              </style>
            </head>
            <body>
              <div class="header">
                <h1>ì˜¤ë²„íƒ€ì„ ë³´ê³ ì„œ</h1>
                <p>${selectedYear}ë…„ ${selectedMonth}</p>
              </div>
              <div class="content">${reportContent}</div>
              <div class="footer">
                <p>ìƒì„±ì¼: ${new Date().toLocaleDateString()}</p>
                <button class="no-print" onclick="window.print()">ì¸ì‡„</button>
                <button class="no-print" onclick="window.close()">ë‹«ê¸°</button>
              </div>
            </body>
          </html>
        `);
        newWindow.document.close();
      }
    };

    return (
      <div className="p-6">
        <div className="mb-6">
          <h1 className="text-3xl font-bold text-gray-900 mb-2">ë³´ê³ ì„œ</h1>
          <p className="text-gray-600">ê¸‰ì—¬ ë° ì˜¤ë²„íƒ€ì„ ë³´ê³ ì„œ ìƒì„±</p>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {/* ê¸‰ì—¬ëª…ì„¸ì„œ ë³´ê³ ì„œ */}
          <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 className="text-xl font-semibold text-gray-900 mb-4">ê¸‰ì—¬ëª…ì„¸ì„œ ë³´ê³ ì„œ</h2>
            <div className="space-y-4">
              <div className="flex items-center space-x-2">
                <select
                  className="flex-1 border border-gray-300 rounded px-3 py-2 text-sm"
                  value={selectedEmployee || ''}
                  onChange={(e) => setSelectedEmployee(e.target.value ? Number(e.target.value) : null)}
                >
                  <option value="">ì „ì²´ ì§ì›</option>
                  {employees.map(emp => (
                    <option key={emp.id} value={emp.id}>
                      {emp.nick_name} ({emp.employee_code})
                    </option>
                  ))}
                </select>
              </div>
              <button
                onClick={() => generatePayrollReport(selectedEmployee || undefined)}
                className="w-full bg-pink-500 text-white py-2 rounded-lg hover:bg-pink-600 transition-colors"
              >
                ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„±
              </button>
            </div>
          </div>

          {/* ì˜¤ë²„íƒ€ì„ ë³´ê³ ì„œ */}
          <div className="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 className="text-xl font-semibold text-gray-900 mb-4">ì˜¤ë²„íƒ€ì„ ë³´ê³ ì„œ</h2>
            <div className="space-y-4">
              <p className="text-sm text-gray-600">
                {selectedYear}ë…„ {selectedMonth} ì˜¤ë²„íƒ€ì„ í˜„í™©ì„ í¬í•¨í•œ ë³´ê³ ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
              </p>
              <button
                onClick={generateOvertimeReport}
                className="w-full bg-pink-500 text-white py-2 rounded-lg hover:bg-pink-600 transition-colors"
              >
                ì˜¤ë²„íƒ€ì„ ë³´ê³ ì„œ ìƒì„±
              </button>
            </div>
          </div>
        </div>

        {/* ë³´ê³ ì„œ í†µê³„ */}
        <div className="mt-6 bg-white rounded-lg shadow-sm border border-gray-200 p-6">
          <h2 className="text-xl font-semibold text-gray-900 mb-4">ë³´ê³ ì„œ í†µê³„</h2>
          <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div className="text-center p-4 bg-gray-50 rounded-lg">
              <p className="text-2xl font-bold text-pink-500">{payrollData.length}</p>
              <p className="text-sm text-gray-600">ê¸‰ì—¬ëª…ì„¸ì„œ</p>
            </div>
            <div className="text-center p-4 bg-gray-50 rounded-lg">
              <p className="text-2xl font-bold text-pink-500">{overtimeData.length}</p>
              <p className="text-sm text-gray-600">ì˜¤ë²„íƒ€ì„ ê¸°ë¡</p>
            </div>
            <div className="text-center p-4 bg-gray-50 rounded-lg">
              <p className="text-2xl font-bold text-pink-500">
                à¸¿{payrollData.reduce((sum, emp) => sum + emp.base_salary, 0).toLocaleString()}
              </p>
              <p className="text-sm text-gray-600">ì´ ê¸°ë³¸ê¸‰</p>
            </div>
            <div className="text-center p-4 bg-gray-50 rounded-lg">
              <p className="text-2xl font-bold text-pink-500">
                {payrollData.reduce((sum, emp) => sum + emp.total_overtime_hours, 0)}ì‹œê°„
              </p>
              <p className="text-sm text-gray-600">ì´ ì˜¤ë²„íƒ€ì„</p>
            </div>
          </div>
        </div>
      </div>
    );
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-100 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-4 text-gray-600">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-100">
      <Sidebar />
      
      <div className={`${sidebarOpen ? 'ml-64' : 'ml-16'} transition-all duration-300`}>
        <main className="p-8">
          {currentView === 'dashboard' && <DashboardView />}
          {currentView === 'payroll' && <PayrollView />}
          {currentView === 'overtime' && <OvertimeView />}
          {currentView === 'employees' && <EmployeesView />}
          {currentView === 'reports' && <ReportsView />}
          {currentView === 'settings' && <SettingsView />}
        </main>
      </div>

      {/* ê¸‰ì—¬ëª…ì„¸ì„œ ëª¨ë‹¬ */}
      {showPayrollModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <h2 className="text-xl font-bold mb-4 text-gray-900">
              {editingPayroll ? 'ê¸‰ì—¬ëª…ì„¸ì„œ ìˆ˜ì •' : 'ìƒˆ ê¸‰ì—¬ëª…ì„¸ì„œ ìƒì„±'}
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì§ì› ì„ íƒ</label>
                <select
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingPayroll ? editingPayroll.employee_id : newPayroll.employee_id}
                  onChange={(e) => {
                    if (editingPayroll) {
                      setEditingPayroll({...editingPayroll, employee_id: Number(e.target.value)});
                    } else {
                      setNewPayroll({...newPayroll, employee_id: Number(e.target.value)});
                    }
                  }}
                  disabled={!!editingPayroll}
                >
                  <option value={0}>ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”</option>
                  {employees.map(emp => (
                    <option key={emp.id} value={emp.id}>
                      {emp.nick_name} ({emp.employee_code})
                    </option>
                  ))}
                </select>
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ê¸°ë³¸ê¸‰</label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingPayroll ? editingPayroll.base_salary : newPayroll.base_salary}
                  onChange={(e) => {
                    if (editingPayroll) {
                      setEditingPayroll({...editingPayroll, base_salary: Number(e.target.value)});
                    } else {
                      setNewPayroll({...newPayroll, base_salary: Number(e.target.value)});
                    }
                  }}
                  onFocus={(e) => {
                    if (e.target.value === '0') {
                      e.target.value = '';
                    }
                  }}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì„±ê³¼ë³´ë„ˆìŠ¤</label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingPayroll ? editingPayroll.performance_bonus : newPayroll.performance_bonus}
                  onChange={(e) => {
                    if (editingPayroll) {
                      setEditingPayroll({...editingPayroll, performance_bonus: Number(e.target.value)});
                    } else {
                      setNewPayroll({...newPayroll, performance_bonus: Number(e.target.value)});
                    }
                  }}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">íŠ¹ë³„ë³´ë„ˆìŠ¤</label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingPayroll ? editingPayroll.special_bonus : newPayroll.special_bonus}
                  onChange={(e) => {
                    if (editingPayroll) {
                      setEditingPayroll({...editingPayroll, special_bonus: Number(e.target.value)});
                    } else {
                      setNewPayroll({...newPayroll, special_bonus: Number(e.target.value)});
                    }
                  }}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì§ì±…ìˆ˜ë‹¹</label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingPayroll ? editingPayroll.position_allowance : newPayroll.position_allowance}
                  onChange={(e) => {
                    if (editingPayroll) {
                      setEditingPayroll({...editingPayroll, position_allowance: Number(e.target.value)});
                    } else {
                      setNewPayroll({...newPayroll, position_allowance: Number(e.target.value)});
                    }
                  }}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì‹ëŒ€</label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingPayroll ? editingPayroll.meal_allowance : newPayroll.meal_allowance}
                  onChange={(e) => {
                    if (editingPayroll) {
                      setEditingPayroll({...editingPayroll, meal_allowance: Number(e.target.value)});
                    } else {
                      setNewPayroll({...newPayroll, meal_allowance: Number(e.target.value)});
                    }
                  }}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">êµí†µë¹„</label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingPayroll ? editingPayroll.transport_allowance : newPayroll.transport_allowance}
                  onChange={(e) => {
                    if (editingPayroll) {
                      setEditingPayroll({...editingPayroll, transport_allowance: Number(e.target.value)});
                    } else {
                      setNewPayroll({...newPayroll, transport_allowance: Number(e.target.value)});
                    }
                  }}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì‚¬íšŒë³´í—˜</label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingPayroll ? editingPayroll.social_insurance : newPayroll.social_insurance}
                  onChange={(e) => {
                    if (editingPayroll) {
                      setEditingPayroll({...editingPayroll, social_insurance: Number(e.target.value)});
                    } else {
                      setNewPayroll({...newPayroll, social_insurance: Number(e.target.value)});
                    }
                  }}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ê°œì¸ì†Œë“ì„¸</label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingPayroll ? editingPayroll.personal_tax : newPayroll.personal_tax}
                  onChange={(e) => {
                    if (editingPayroll) {
                      setEditingPayroll({...editingPayroll, personal_tax: Number(e.target.value)});
                    } else {
                      setNewPayroll({...newPayroll, personal_tax: Number(e.target.value)});
                    }
                  }}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì„ ì§€ê¸‰ê¸ˆ</label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingPayroll ? editingPayroll.advance_salary : newPayroll.advance_salary}
                  onChange={(e) => {
                    if (editingPayroll) {
                      setEditingPayroll({...editingPayroll, advance_salary: Number(e.target.value)});
                    } else {
                      setNewPayroll({...newPayroll, advance_salary: Number(e.target.value)});
                    }
                  }}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ê¸‰ì—¬ê³µì œ</label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingPayroll ? editingPayroll.salary_deduction : newPayroll.salary_deduction}
                  onChange={(e) => {
                    if (editingPayroll) {
                      setEditingPayroll({...editingPayroll, salary_deduction: Number(e.target.value)});
                    } else {
                      setNewPayroll({...newPayroll, salary_deduction: Number(e.target.value)});
                    }
                  }}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ê¸°íƒ€ê³µì œ</label>
                <input
                  type="number"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingPayroll ? editingPayroll.other_deductions : newPayroll.other_deductions}
                  onChange={(e) => {
                    if (editingPayroll) {
                      setEditingPayroll({...editingPayroll, other_deductions: Number(e.target.value)});
                    } else {
                      setNewPayroll({...newPayroll, other_deductions: Number(e.target.value)});
                    }
                  }}
                />
              </div>
            </div>
            <div className="flex space-x-2 mt-6">
              <button
                onClick={editingPayroll ? handleUpdatePayroll : handleAddPayroll}
                className="flex-1 bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition-colors"
              >
                {editingPayroll ? 'ìˆ˜ì •' : 'ìƒì„±'}
              </button>
              <button
                onClick={() => {
                  setShowPayrollModal(false);
                  setEditingPayroll(null);
                }}
                className="flex-1 bg-gray-300 text-gray-700 py-2 rounded hover:bg-gray-400"
              >
                ì·¨ì†Œ
              </button>
            </div>
          </div>
        </div>
      )}

      {/* ì˜¤ë²„íƒ€ì„ ëª¨ë‹¬ */}
      {showOvertimeModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 w-full max-w-2xl">
            <h2 className="text-xl font-bold mb-4 text-gray-900">
              {editingOvertime ? 'ì˜¤ë²„íƒ€ì„ ìˆ˜ì •' : 'ìƒˆ ì˜¤ë²„íƒ€ì„ ë“±ë¡'}
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì§ì› ì„ íƒ</label>
                <select
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingOvertime ? editingOvertime.employee_id : newOvertime.employee_id}
                  onChange={(e) => {
                    if (editingOvertime) {
                      setEditingOvertime({...editingOvertime, employee_id: Number(e.target.value)});
                    } else {
                      setNewOvertime({...newOvertime, employee_id: Number(e.target.value)});
                    }
                  }}
                  disabled={!!editingOvertime}
                >
                  <option value={0}>ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”</option>
                  {employees.map(emp => (
                    <option key={emp.id} value={emp.id}>
                      {emp.nick_name} ({emp.employee_code})
                    </option>
                  ))}
                </select>
              </div>
              
              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ë‚ ì§œ</label>
                <input
                  type="date"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingOvertime ? editingOvertime.overtime_date : newOvertime.overtime_date}
                  onChange={(e) => {
                    if (editingOvertime) {
                      setEditingOvertime({...editingOvertime, overtime_date: e.target.value});
                    } else {
                      setNewOvertime({...newOvertime, overtime_date: e.target.value});
                    }
                  }}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì‹œì‘ ì‹œê°„</label>
                <input
                  type="time"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingOvertime ? editingOvertime.start_time : newOvertime.start_time}
                  onChange={(e) => {
                    if (editingOvertime) {
                      setEditingOvertime({...editingOvertime, start_time: e.target.value});
                    } else {
                      setNewOvertime({...newOvertime, start_time: e.target.value});
                    }
                  }}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì¢…ë£Œ ì‹œê°„</label>
                <input
                  type="time"
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingOvertime ? editingOvertime.end_time : newOvertime.end_time}
                  onChange={(e) => {
                    if (editingOvertime) {
                      setEditingOvertime({...editingOvertime, end_time: e.target.value});
                    } else {
                      setNewOvertime({...newOvertime, end_time: e.target.value});
                    }
                  }}
                />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ìš°ì„ ìˆœìœ„</label>
                <select
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingOvertime ? editingOvertime.priority : newOvertime.priority}
                  onChange={(e) => {
                    if (editingOvertime) {
                      setEditingOvertime({...editingOvertime, priority: e.target.value as any});
                    } else {
                      setNewOvertime({...newOvertime, priority: e.target.value as any});
                    }
                  }}
                >
                  <option value="LOW">ë‚®ìŒ</option>
                  <option value="MEDIUM">ë³´í†µ</option>
                  <option value="HIGH">ë†’ìŒ</option>
                  <option value="URGENT">ê¸´ê¸‰</option>
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 mb-2">ì‚¬ìœ </label>
                <select
                  className="w-full p-2 border border-gray-300 rounded text-gray-900"
                  value={editingOvertime ? editingOvertime.reason : newOvertime.reason}
                  onChange={(e) => {
                    if (editingOvertime) {
                      setEditingOvertime({...editingOvertime, reason: e.target.value as any});
                    } else {
                      setNewOvertime({...newOvertime, reason: e.target.value as any});
                    }
                  }}
                >
                  <option value="PROJECT_DEADLINE">í”„ë¡œì íŠ¸ ë§ˆê°</option>
                  <option value="URGENT_TASK">ê¸´ê¸‰ ì—…ë¬´</option>
                  <option value="SYSTEM_MAINTENANCE">ì‹œìŠ¤í…œ ì •ë¹„</option>
                  <option value="MEETING">íšŒì˜</option>
                  <option value="OTHER">ê¸°íƒ€</option>
                </select>
              </div>
            </div>

            <div className="mt-4">
              <label className="block text-sm font-medium text-gray-700 mb-2">ì—…ë¬´ ë‚´ìš©</label>
              <textarea
                className="w-full p-2 border border-gray-300 rounded text-gray-900"
                rows={3}
                value={editingOvertime ? editingOvertime.work_description : newOvertime.work_description}
                onChange={(e) => {
                  if (editingOvertime) {
                    setEditingOvertime({...editingOvertime, work_description: e.target.value});
                  } else {
                    setNewOvertime({...newOvertime, work_description: e.target.value});
                  }
                }}
                placeholder="ì—…ë¬´ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
              />
            </div>

            <div className="flex space-x-2 mt-6">
              <button
                onClick={editingOvertime ? handleUpdateOvertime : handleAddOvertime}
                className="flex-1 bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition-colors"
              >
                {editingOvertime ? 'ìˆ˜ì •' : 'ë“±ë¡'}
              </button>
              <button
                onClick={() => {
                  setShowOvertimeModal(false);
                  setEditingOvertime(null);
                }}
                className="flex-1 bg-gray-300 text-gray-700 py-2 rounded hover:bg-gray-400"
              >
                ì·¨ì†Œ
              </button>
            </div>
          </div>
        </div>
      )}

      {/* ì§ì› ëª¨ë‹¬ */}
      {showEmployeeModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-2xl font-bold text-gray-900">
                {editingEmployee ? 'ì§ì› ì •ë³´ ìˆ˜ì •' : 'ìƒˆ ì§ì› ë“±ë¡'}
              </h2>
              <button
                onClick={() => {
                  setShowEmployeeModal(false);
                  setEditingEmployee(null);
                  // í¼ ì´ˆê¸°í™”
                  setNewEmployee({
                    employee_code: '',
                    nick_name: '',
                    full_name: '',
                    full_name_thai: '',
                    department: 'IT',
                    start_date: '',
                    bank_name: '',
                    bank_account: '',
                    monthly_salary: 0,
                    social_insurance_rate: 5,
                    tax_rate: 10,
                    performance_rating: 3,
                    status: 'ACTIVE'
                  });
                }}
                className="text-gray-400 hover:text-gray-600"
              >
                <X size={24} />
              </button>
            </div>

            <div className="space-y-6">
              {/* ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ */}
              <div className="bg-gray-50 p-4 rounded-lg">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">ê¸°ë³¸ ì •ë³´</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      ì§ì›ì½”ë“œ <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      placeholder="ì˜ˆ: EMP001"
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      value={editingEmployee ? editingEmployee.employee_code : newEmployee.employee_code}
                      onChange={(e) => {
                        if (editingEmployee) {
                          setEditingEmployee({...editingEmployee, employee_code: e.target.value});
                        } else {
                          setNewEmployee({...newEmployee, employee_code: e.target.value});
                        }
                      }}
                      disabled={!!editingEmployee}
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      ë‹‰ë„¤ì„ <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      placeholder="ì˜ˆ: ê¹€ì² ìˆ˜"
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      value={editingEmployee ? editingEmployee.nick_name : newEmployee.nick_name}
                      onChange={(e) => {
                        if (editingEmployee) {
                          setEditingEmployee({...editingEmployee, nick_name: e.target.value});
                        } else {
                          setNewEmployee({...newEmployee, nick_name: e.target.value});
                        }
                      }}
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      ì „ì²´ì´ë¦„ <span className="text-red-500">*</span>
                    </label>
                    <input
                      type="text"
                      placeholder="ì˜ˆ: ê¹€ì² ìˆ˜"
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      value={editingEmployee ? editingEmployee.full_name : newEmployee.full_name}
                      onChange={(e) => {
                        if (editingEmployee) {
                          setEditingEmployee({...editingEmployee, full_name: e.target.value});
                        } else {
                          setNewEmployee({...newEmployee, full_name: e.target.value});
                        }
                      }}
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">íƒœêµ­ì–´ ì´ë¦„</label>
                    <input
                      type="text"
                      placeholder="ì˜ˆ: à¸„à¸´à¸¡à¸Šà¸­à¸¥à¸‹à¸¹"
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      value={editingEmployee ? editingEmployee.full_name_thai : newEmployee.full_name_thai}
                      onChange={(e) => {
                        if (editingEmployee) {
                          setEditingEmployee({...editingEmployee, full_name_thai: e.target.value});
                        } else {
                          setNewEmployee({...newEmployee, full_name_thai: e.target.value});
                        }
                      }}
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">ë¶€ì„œ</label>
                    <select
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      value={editingEmployee ? editingEmployee.department : newEmployee.department}
                      onChange={(e) => {
                        if (editingEmployee) {
                          setEditingEmployee({...editingEmployee, department: e.target.value});
                        } else {
                          setNewEmployee({...newEmployee, department: e.target.value});
                        }
                      }}
                    >
                      <option value="IT">IT</option>
                      <option value="HR">HR</option>
                      <option value="Finance">Finance</option>
                      <option value="Marketing">Marketing</option>
                      <option value="Sales">Sales</option>
                      <option value="Operations">Operations</option>
                    </select>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">ì…ì‚¬ì¼</label>
                    <input
                      type="date"
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      value={editingEmployee ? editingEmployee.start_date : newEmployee.start_date}
                      onChange={(e) => {
                        if (editingEmployee) {
                          setEditingEmployee({...editingEmployee, start_date: e.target.value});
                        } else {
                          setNewEmployee({...newEmployee, start_date: e.target.value});
                        }
                      }}
                    />
                  </div>
                </div>
              </div>

              {/* ê¸‰ì—¬ ì •ë³´ ì„¹ì…˜ */}
              <div className="bg-gray-50 p-4 rounded-lg">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">ê¸‰ì—¬ ì •ë³´</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">ì›”ê¸‰ (ì›)</label>
                    <input
                      type="number"
                      placeholder="ì˜ˆ: 3000000"
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      value={editingEmployee ? editingEmployee.monthly_salary : newEmployee.monthly_salary}
                      onChange={(e) => {
                        if (editingEmployee) {
                          setEditingEmployee({...editingEmployee, monthly_salary: Number(e.target.value)});
                        } else {
                          setNewEmployee({...newEmployee, monthly_salary: Number(e.target.value)});
                        }
                      }}
                      onFocus={(e) => {
                        if (e.target.value === '0') {
                          e.target.value = '';
                        }
                      }}
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">ì„±ê³¼ë“±ê¸‰</label>
                    <select
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      value={editingEmployee ? editingEmployee.performance_rating : newEmployee.performance_rating}
                      onChange={(e) => {
                        if (editingEmployee) {
                          setEditingEmployee({...editingEmployee, performance_rating: Number(e.target.value)});
                        } else {
                          setNewEmployee({...newEmployee, performance_rating: Number(e.target.value)});
                        }
                      }}
                    >
                      <option value={1}>1ë“±ê¸‰ (ìµœí•˜)</option>
                      <option value={2}>2ë“±ê¸‰ (í•˜)</option>
                      <option value={3}>3ë“±ê¸‰ (ë³´í†µ)</option>
                      <option value={4}>4ë“±ê¸‰ (ìƒ)</option>
                      <option value={5}>5ë“±ê¸‰ (ìµœìƒ)</option>
                    </select>
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">ì‚¬íšŒë³´í—˜ìœ¨ (%)</label>
                    <input
                      type="number"
                      placeholder="ì˜ˆ: 5"
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      value={editingEmployee ? editingEmployee.social_insurance_rate : newEmployee.social_insurance_rate}
                      onChange={(e) => {
                        if (editingEmployee) {
                          setEditingEmployee({...editingEmployee, social_insurance_rate: Number(e.target.value)});
                        } else {
                          setNewEmployee({...newEmployee, social_insurance_rate: Number(e.target.value)});
                        }
                      }}
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">ì„¸ìœ¨ (%)</label>
                    <input
                      type="number"
                      placeholder="ì˜ˆ: 10"
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      value={editingEmployee ? editingEmployee.tax_rate : newEmployee.tax_rate}
                      onChange={(e) => {
                        if (editingEmployee) {
                          setEditingEmployee({...editingEmployee, tax_rate: Number(e.target.value)});
                        } else {
                          setNewEmployee({...newEmployee, tax_rate: Number(e.target.value)});
                        }
                      }}
                    />
                  </div>
                </div>
              </div>

              {/* ì€í–‰ ì •ë³´ ì„¹ì…˜ */}
              <div className="bg-gray-50 p-4 rounded-lg">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">ì€í–‰ ì •ë³´</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">ì€í–‰ëª…</label>
                    <input
                      type="text"
                      placeholder="ì˜ˆ: ì‹ í•œì€í–‰"
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      value={editingEmployee ? editingEmployee.bank_name : newEmployee.bank_name}
                      onChange={(e) => {
                        if (editingEmployee) {
                          setEditingEmployee({...editingEmployee, bank_name: e.target.value});
                        } else {
                          setNewEmployee({...newEmployee, bank_name: e.target.value});
                        }
                      }}
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">ê³„ì¢Œë²ˆí˜¸</label>
                    <input
                      type="text"
                      placeholder="ì˜ˆ: 110-123456-789"
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      value={editingEmployee ? editingEmployee.bank_account : newEmployee.bank_account}
                      onChange={(e) => {
                        if (editingEmployee) {
                          setEditingEmployee({...editingEmployee, bank_account: e.target.value});
                        } else {
                          setNewEmployee({...newEmployee, bank_account: e.target.value});
                        }
                      }}
                    />
                  </div>
                </div>
              </div>

              {/* ìƒíƒœ ì •ë³´ ì„¹ì…˜ */}
              <div className="bg-gray-50 p-4 rounded-lg">
                <h3 className="text-lg font-semibold text-gray-900 mb-4">ìƒíƒœ ì •ë³´</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">ìƒíƒœ</label>
                    <select
                      className="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                      value={editingEmployee ? editingEmployee.status : newEmployee.status}
                      onChange={(e) => {
                        if (editingEmployee) {
                          setEditingEmployee({...editingEmployee, status: e.target.value as any});
                        } else {
                          setNewEmployee({...newEmployee, status: e.target.value as any});
                        }
                      }}
                    >
                      <option value="ACTIVE">í™œì„±</option>
                      <option value="INACTIVE">ë¹„í™œì„±</option>
                      <option value="TERMINATED">í‡´ì‚¬</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            {/* ë²„íŠ¼ ì˜ì—­ */}
            <div className="flex space-x-3 mt-8 pt-6 border-t border-gray-200">
              <button
                onClick={editingEmployee ? handleUpdateEmployee : handleAddEmployee}
                className="flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors font-medium"
              >
                {editingEmployee ? 'ìˆ˜ì • ì™„ë£Œ' : 'ì§ì› ë“±ë¡'}
              </button>
              <button
                onClick={() => {
                  setShowEmployeeModal(false);
                  setEditingEmployee(null);
                  // í¼ ì´ˆê¸°í™”
                  setNewEmployee({
                    employee_code: '',
                    nick_name: '',
                    full_name: '',
                    full_name_thai: '',
                    department: 'IT',
                    start_date: '',
                    bank_name: '',
                    bank_account: '',
                    monthly_salary: 0,
                    social_insurance_rate: 5,
                    tax_rate: 10,
                    performance_rating: 3,
                    status: 'ACTIVE'
                  });
                }}
                className="flex-1 bg-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-400 transition-colors font-medium"
              >
                ì·¨ì†Œ
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default PayrollDashboard; 